# pvuv访问量的实现

判断一个网站值不值钱的一个重要标准就是看pv/uv，那么你知道pv,uv是怎么统计的么？当然现在有第三方做的比较完善的可以直接使用，但如果让我们自己来实现这么一个功能，应该怎么做呢？

## 背景及需求

为了看看我的博客是不是我一个人的单机游戏，所以就想着统计一下总的访问量，每日的访问人数，哪些博文又是大家感兴趣的，点击得多的；

因此就萌发了自己撸一个pv/uv统计的服务，当然我这个也不需要特别完善高大上，能满足我自己的基本需要就可以了

- 希望统计站点(域名）总访问次数
- 希望统计站点总的访问人数，当前访问者在访问人数中的排名（即这个ip是所有访问ip中的第多少位访问的这个站点）
- 每个子页面都有访问次数，访问总人数，当前ip访问的排名统计
- 同一个ip，同一天内访问同一个子页面，pv次数只加1次；隔天之后，再次访问pv+1

## II. 方案设计

前面的背景和需求，可以说大致说明了我们要做个什么东西，以及需要注意哪些事项，再进行方案设计的过程中，则需要对需求进行详细拆解

### 1. 术语说明

前面提到了pv,uv，在我们的实际实现中，会发现这个服务中对于pv,uv的定义和标准定义并不是完全一致的，下面进行说明

#### a. pv

`page viste`, 每个页面的访问次数，在本服务中，我们的pv指的是总量，即从开始接入时，到现在总的访问次数

但是这里有个限制： **一个合法的ip，一天之内pv统计次数只能+1次**

- 根据ip进行区分，因此需要获取访问者ip
- 同一天内，这个ip访问相同的URI，只能算一次有效pv；第二天之后，再次访问，则可以再算一次有效pv

#### b. hot

前面的pv针对ip进行了限制，一个ip同一天的访问，只能计算一次，大部分情况下这种统计并没有什么问题，但是如果一个文章写得特别有参考意义，导致有人重复的看，仔细的看，换着花样的刷新看，这个时候统计下总的访问次数是不是也挺好的

因此在这个服务中，引入了hot（热度）的概念，对于一个uri而言，只要一次点击，hot+1

#### c. uv

`unique visitor`, 这个就是统计URI的访问ip数